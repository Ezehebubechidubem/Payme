<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PAYME</title>

  <!-- Font Awesome (icons) -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>

  <style>
    :root{
      --primary:#00c853;
      --primary-dark:#009624;
      --bg:#ffffff;
      --card:#ffffff;
      --muted:#777;
      --soft:#e8f5e9;
      --line:#e0e0e0;
      --badge:#ff3b30;
      --text:#1b1b1b;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      padding-bottom:84px;
    }
    .app{max-width:440px;margin:0 auto}
    .topbar{
      background:var(--card);
      padding:14px 16px 12px;
      display:flex;align-items:center;gap:12px;
      border-bottom:1px solid var(--line);
      position:sticky;top:0;z-index:10;
    }
    .avatar{width:34px;height:34px;border-radius:50%;
      background:linear-gradient(135deg,#222,#666);flex:0 0 auto;}
    .hello{line-height:1.1}
    .hello .hi{font-weight:700;font-size:15px}
    .hello .sub{font-size:12px;color:var(--muted);margin-top:2px}
    .topbar-actions{margin-left:auto;display:flex;align-items:center;gap:14px}
    .icon-btn{position:relative;font-size:18px;color:var(--muted);cursor:pointer}
    .badge{position:absolute;top:-6px;right:-8px;background:var(--badge);color:#fff;
      font-size:10px;font-weight:700;line-height:1;padding:3px 5px;border-radius:10px;}
    .card{background:var(--soft);margin:12px; padding:14px; border-radius:14px;
      box-shadow:0 1px 0 rgba(0,0,0,.02) inset;}
    .row{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .label{font-size:12px;color:#555;display:flex;align-items:center;gap:6px}
    .label i{font-size:12px}
    .amount{margin-top:4px;font-weight:800;font-size:26px;color:var(--primary-dark);
      display:flex;align-items:center;gap:6px}
    .chip-link{font-size:12px;color:#555;display:flex;align-items:center;gap:6px}
    .ghost-link{font-weight:600;color:var(--primary-dark)}
    .btn{background:var(--primary);color:#fff;border:0;cursor:pointer;
      padding:10px 16px;border-radius:22px;font-weight:700;font-size:13px}
    .btn:hover{background:var(--primary-dark)}
    .inline-promo{margin-top:12px;background:#fff;border-radius:10px;
      padding:10px 12px;display:flex;align-items:center;gap:10px}
    .inline-promo .dot{flex:0 0 auto;width:18px;height:18px;border-radius:50%;
      background:#c8e6c9;display:grid;place-items:center;color:var(--primary);font-size:11px}
    .inline-promo .text{font-size:13px;color:#333}
    .inline-promo .link{margin-left:auto;display:flex;align-items:center;gap:8px;color:var(--primary);font-weight:700}
    .quick{background:var(--card);margin:0 12px;border-radius:14px;padding:14px 8px;
      display:grid;grid-template-columns:repeat(3,1fr);text-align:center}
    .qa{display:flex;flex-direction:column;align-items:center;gap:6px;font-size:13px;color:#333}
    .qa i{font-size:20px;color:var(--primary)}
    .fee{font-size:10px;background:#fff3cd;color:#8a6d3b;border:1px solid #ffe49d;padding:1px 5px;border-radius:7px;margin-left:4px}
    .qr{font-size:11px;background:#c8e6c9;color:#2e7d32;padding:2px 6px;border-radius:7px;margin-left:6px}
    .promo-card{margin:12px;background:var(--card);border-radius:14px;padding:14px;
      display:flex;align-items:center;justify-content:space-between;gap:10px}
    .promo-card .title{font-weight:800;color:#2e7d32}
    .promo-card .sub{font-size:12px;color:#666;margin-top:2px}
    .outline{border:1px solid var(--primary);background:#fff;color:var(--primary);padding:8px 14px;border-radius:18px;font-weight:700;cursor:pointer}
    .services{margin:12px;background:var(--card);border-radius:14px;padding:14px}
    .services .head{display:flex;align-items:center;justify-content:space-between}
    .services .head h3{font-size:16px}
    .services .more{color:#666;display:flex;align-items:center;gap:6px;font-size:13px}
    .grid{margin-top:12px;display:grid;grid-template-columns:repeat(4,1fr);gap:18px 12px}
    .svc{text-align:center;font-size:12.5px;color:#333;cursor:pointer}
    .svc i{display:block;margin:0 auto 6px;font-size:20px;color:var(--primary)}
    .big-banner{margin:12px;background:linear-gradient(135deg,#00c853,#43a047);
      color:#fff;border-radius:14px;padding:16px;text-align:center}
    .big-banner h2{font-size:18px;font-weight:900;letter-spacing:.2px}
    .tag{display:inline-block;background:#ffec66;color:#2e2e2e;border-radius:16px;padding:7px 12px;font-weight:800;margin-top:10px}
    .refer{margin:12px;background:var(--card);border-radius:14px;padding:14px;
      display:flex;align-items:center;justify-content:space-between}
    .refer h4{font-size:15px}
    .refer p{font-size:13px;color:#666;margin-top:3px}
    .refer .go{background:var(--primary);color:#fff;border:0;border-radius:18px;padding:8px 16px;font-weight:700}
    .bottom{position:fixed;left:0;right:0;bottom:0;background:#fff;border-top:1px solid var(--line);
      display:grid;grid-template-columns:repeat(5,1fr);padding:8px 0;z-index:20}
    .nav-item{text-align:center;font-size:11px;color:#666}
    .nav-item i{display:block;font-size:18px;margin-bottom:2px;color:#666}
    .nav-item.active, .nav-item.active i{color:#000}
    a{text-decoration:none;color:inherit}
    button{font:inherit}
  </style>
</head>
<body>
  <div class="app">
    <!-- Top bar -->
    <header class="topbar">
      <div class="avatar" aria-hidden="true"></div>
      <div class="hello">
        <div class="hi"><a href="profile.html" id="hiUser">Hi, User</a></div>
        <div class="sub">Welcome, let's make payments!</div>
      </div>
      <div class="topbar-actions">
        <div class="icon-btn" title="Help"><i class="fa-solid fa-headset"></i></div>
        <div class="icon-btn" title="Notifications">
          <i class="fa-solid fa-bell"></i>
          <span class="badge">99+</span>
        </div>
      </div>
    </header>

    <!-- Balance card -->
    <section class="card">
      <div class="row">
        <div>
          <div class="label"><i class="fa-regular fa-circle-question"></i> Available Balance</div>
          <div class="amount" id="balance">₦0.00</div>
        </div>
        <div style="text-align:right">
          <a iclass="chip-link" href="transactions.html"><span>Transaction History</span> <i class="fa-solid fa-angle-right"></i></a>
          <div style="margin-top:8px">
            <a href="addmoney.html"class="btn">Add Money</a>
          </div>
        </div>
      </div>

      <div class="inline-promo">
        <div class="dot"><i class="fa-solid fa-arrow-trend-up"></i></div>
        <div class="text">Higher return? Increase deposit with <strong>20% p.a.</strong></div>
        <a href="#" class="link">Go <i class="fa-solid fa-angle-right"></i></a>
      </div>
    </section>

    <!-- Quick actions -->
    <section class="quick">
      <div class="qa">
        <i class="fa-solid fa-building-columns"></i><a href="toWallet.html">
        <div>To Bank <span class="fee">0 Fee</span></div></a>
      </div>
 <div class="qa">
        <i class="fa-solid fa-user"></i>
        <a href="toBank.html"><div>To Wallet</div></a>
      </div>
   <a href="PaymeCrypto.html"<div class="qa">
  <i class="fa-brands fa-btc"></i>
  <div>To Crypto Wallet</div></a>
</div>
      
    </section>

    <!-- Promo -->
    <section class="promo-card">
      <div>
        <div class="title">Verve Virtual Card 50% Off today</div>
        <div class="sub">One-Click Instant Access and Use it at Google Play, Netflix &hellip;</div>
      </div>
      <button class="outline">View</button>
    </section>

    <!-- Services -->
    <section class="services">
      <div class="head">
        <h3>Services</h3>
        <a href="services.html" class="more">More <i class="fa-solid fa-angle-right"></i></a>
      </div>
      <div class="grid">
         <a href="services.html"<div class="svc"><i class="fa-solid fa-phone"></i>Airtime</div></a>
        <div class="svc"><i class="fa-solid fa-signal"></i>Data</div>
        <div class="svc"><i class="fa-solid fa-dice"></i>Betting</div>
        <div class="svc"><i class="fa-solid fa-bolt"></i>Electricity</div>
        <div class="svc"><i class="fa-solid fa-shield-halved"></i>Insurance</div>
        <div class="svc"><i class="fa-solid fa-coins"></i>Loan</div>
        <div class="svc"><i class="fa-solid fa-tv"></i>TV</div>
        <div class="svc"><i class="fa-solid fa-gift"></i>Refer &amp; Earn</div>
        <div class="svc"><i class="fa-solid fa-money-bill"></i>Withdraw</div>
        <div class="svc"><i class="fa-solid fa-box"></i>CashBox</div>
        <div class="svc"><i class="fa-solid fa-lightbulb"><a href="savings.html"></i>SmartEarn</div></a>
        <div class="svc"><i class="fa-solid fa-store"></i>My Business Hub</div>
      </div>
    </section>

    <!-- Big banner -->
    <section class="big-banner">
      <h2>FREE ₦500K HEALTH COVERAGE</h2>
      <div class="tag">Claim Now</div>
    </section>

    <!-- Refer & Earn -->
    <section class="refer">
      <div>
        <h4>Refer &amp; Earn</h4>
        <p>Win up to ₦10,000 Cash — Invite new users now</p>
      </div>
      <button class="go">Go Now</button>
    </section>
  </div>

  <!-- Bottom navigation -->
  <nav class="bottom">
    <a class="nav-item active" href="#"><i class="fa-solid fa-house"></i>Home</a>
    <a class="nav-item" href="#"><i class="fa-solid fa-credit-card"></i>Loan</a>
    <a class="nav-item" href="#"><i class="fa-solid fa-chart-line"></i>Wealth</a>
    <a class="nav-item" href="#"><i class="fa-solid fa-gift"></i>Reward</a>
    <a class="nav-item" href="profile.html"><i class="fa-solid fa-user"></i>Me</a>
  </nav>

<script>
  // Backend base
  const API_BASE = "https://payme-update.onrender.com";

  // Utility: try to get user from either key used in your app
  function getStoredUser() {
    const j = localStorage.getItem("loggedInUser") || localStorage.getItem("user");
    try {
      return j ? JSON.parse(j) : null;
    } catch (e) {
      return null;
    }
  }

  // Update UI elements for user and balance
  function updateUIWithUser(user) {
    if (!user) return;
    const hi = document.getElementById("hiUser");
    if (hi) hi.innerText = "Hi, " + (user.username || user.name || "User");
    const balEl = document.getElementById("balance");
    if (balEl) {
      const b = typeof user.balance !== "undefined" ? Number(user.balance) : 0;
      balEl.innerText = "₦" + b.toFixed(2);
    }
  }

  // Fetch balance from backend and persist to storage
  async function fetchAndUpdateBalance() {
    const user = getStoredUser();
    if (!user || !user.phone) return;
    try {
      const res = await fetch(`${API_BASE}/balance/${encodeURIComponent(user.phone)}`, { cache: "no-store" });
      if (!res.ok) {
        // still update UI from stored user
        updateUIWithUser(user);
        return;
      }
      const data = await res.json();
      // backend returns { balance: <number> }
      if (data && (typeof data.balance === "number" || !isNaN(Number(data.balance)))) {
        user.balance = Number(data.balance);
        // store in both keys to remain compatible across your app
        localStorage.setItem("loggedInUser", JSON.stringify(user));
        localStorage.setItem("user", JSON.stringify(user));
        updateUIWithUser(user);
      } else {
        // fallback UI update
        updateUIWithUser(user);
      }
    } catch (err) {
      // offline or backend unreachable
      console.warn("Could not fetch balance:", err);
      // still show whatever stored value we have
      updateUIWithUser(user);
    }
  }

  // Initial load
  window.addEventListener("load", () => {
    const user = getStoredUser();
    if (!user) {
      // keep behavior consistent with original (do not redirect here)
      return;
    }
    // show stored values immediately, then fetch latest
    updateUIWithUser(user);
    fetchAndUpdateBalance();
  });

  // Refresh when tab gets focus (user likely returned from add-money)
  window.addEventListener("focus", () => {
    fetchAndUpdateBalance();
  });

  // Refresh when page becomes visible
  document.addEventListener("visibilitychange", () => {
    if (document.visibilityState === "visible") {
      fetchAndUpdateBalance();
    }
  });

  // Listen for storage changes (e.g., another tab updated loggedInUser after add-money)
  window.addEventListener("storage", (e) => {
    if (!e) return;
    if (e.key === "loggedInUser" || e.key === "user") {
      // small debounce
      setTimeout(fetchAndUpdateBalance, 50);
    }
  });

  // Poll every 15s as an extra guard (won't run if user not logged)
  setInterval(() => {
    const user = getStoredUser();
    if (user && user.phone) fetchAndUpdateBalance();
  }, 15000);
</script>
</body>
</html>