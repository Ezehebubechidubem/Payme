<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Payme — Monitoring</title>
<style>
 :root{--bg:#fff;--text:#000;--green:#10b981;--muted:#6b7280;--card:#f8fafb}
 body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,Arial}
 header{padding:18px;border-bottom:1px solid #f0f2f3}
 .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;padding:18px}
 .card{background:var(--card);padding:14px;border-radius:12px}
 table{width:100%;border-collapse:collapse}
 th,td{padding:8px;border-bottom:1px solid #eee}
 .muted{color:var(--muted)}
 .btn{background:var(--green);color:#fff;padding:8px;border-radius:8px;border:0;cursor:pointer}
</style>
</head>
<body>
<header>
  <a href="index.html" style="color:#6b7280;text-decoration:none">← Dashboard</a>
  <h2 style="margin:6px 0">5 — Monitoring</h2>
  <div class="muted">View daily volume, deposits, withdrawals, branches, active users, fraud attempts and failed transaction counts.</div>
</header>

<div class="grid">
  <div class="card">
    <h4>Total Volume (24h)</h4>
    <div style="font-size:22px;font-weight:800;margin-top:8px" id="vol">₦0</div>
  </div>
  <div class="card">
    <h4>Total Deposits</h4>
    <div style="font-size:22px;font-weight:800;margin-top:8px" id="dep">₦0</div>
  </div>
  <div class="card">
    <h4>Total Withdrawals</h4>
    <div style="font-size:22px;font-weight:800;margin-top:8px" id="wd">₦0</div>
  </div>

  <div class="card" style="grid-column:span 3">
    <h4>Transaction summary (last 7 days)</h4>
    <table>
      <thead><tr><th>Date</th><th>Volume</th><th>Deposits</th><th>Withdrawals</th></tr></thead>
      <tbody id="summary"></tbody>
    </table>
  </div>

  <div class="card">
    <h4>Fraud Attempts</h4>
    <div id="fraudCount" style="font-weight:800;font-size:18px;margin-top:8px">0</div>
    <button class="btn" style="margin-top:10px" onclick="location.href='fraud.html'">Investigate</button>
  </div>

  <div class="card">
    <h4>Failed Transactions</h4>
    <div id="failedCount" style="font-weight:800;font-size:18px;margin-top:8px">0</div>
    <button class="btn" style="margin-top:10px" onclick="alert('Open transactions page in real app')">View</button>
  </div>

  <div class="card">
    <h4>Active Users</h4>
    <div id="actUsers" style="font-weight:800;font-size:18px;margin-top:8px">0</div>
  </div>
</div>

<script>


  // ---------- Fetch Metrics ----------
  
    const metricsRes = await fetch("https://payme-update.onrender.com/admin/metrics", { credentials:"include" });
    const metrics = await metricsRes.json();
    if(metrics.status==="success"){
      document.getElementById('vol').innerText = `₦${Number(metrics.total_volume).toLocaleString()}`;
      document.getElementById('dep').innerText = `₦${Number(metrics.deposits).toLocaleString()}`;
      document.getElementById('wd').innerText = `₦${Number(metrics.withdrawals).toLocaleString()}`;
      document.getElementById('actUsers').innerText = Number(metrics.active_users).toLocaleString();
    }
  } catch(err){
    console.error("Metrics fetch failed", err);
  

  // ---------- Fetch 7-day Transaction Summary ----------
  try {
    const summaryRes = await fetch("https://payme-update.onrender.com/admin/daily_summary", { credentials:"include" });
    const data = await summaryRes.json();
    if(data.status==="success" && data.summary){
      const rows = data.summary.map(r=>`<tr>
        <td>${r.day}</td>
        <td>₦${Number(r.total).toLocaleString()}</td>
        <td>₦${Number(r.deposits).toLocaleString()}</td>
        <td>₦${Number(r.withdrawals).toLocaleString()}</td>
      </tr>`);
      document.getElementById('summary').innerHTML = rows.join('');
    }
  } catch(err){
    console.error("Daily summary fetch failed", err);
  }

  // ---------- Demo placeholders for Fraud & Failed Tx (optional) ----------
  document.getElementById('fraudCount').innerText = '3';       // replace with real DB query if available
  document.getElementById('failedCount').innerText = '12';     // replace with real DB query if available
})();
</script>
</body>
</html>
