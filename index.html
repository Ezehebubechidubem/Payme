<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PayGo App</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* (same CSS you already provided) */
    :root { --primary:#5b4dff; --accent:#007bff; --bg:#f3f6fa; --card:#fff; --muted:#6b7280; --success:#0b6b3a; }
    *{box-sizing:border-box} body{font-family:Inter,Arial,sans-serif;margin:0;background:var(--bg);color:#222;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
    .hidden{display:none!important}
    header{display:flex;justify-content:space-between;align-items:center;background:var(--accent);color:#fff;padding:14px 16px;box-shadow:0 2px 6px rgba(0,0,0,.08);position:relative}
    .logo{font-weight:800;font-size:18px;letter-spacing:.6px}.hamburger{font-size:20px;cursor:pointer}
    #profileMenu{position:absolute;right:12px;top:56px;background:var(--card);border-radius:10px;display:none;box-shadow:0 10px 30px rgba(0,0,0,.12);z-index:200;width:200px}
    #profileMenu div{padding:10px 14px;cursor:pointer;border-bottom:1px solid #f1f4f8;color:#333}#profileMenu div:last-child{border-bottom:none}#profileMenu div:hover{background:#f7f8ff}
    .wrap{max-width:520px;margin:18px auto;padding:12px}.card{background:var(--card);border-radius:12px;padding:14px;box-shadow:0 6px 20px rgba(0,0,0,.06);margin-bottom:12px}
    h2,h3{margin:6px 0;font-weight:600}input,button,textarea,select{width:100%;padding:10px;margin:8px 0;border-radius:8px;border:1px solid #e6eefc;font-size:14px;background:#fff}
    button{background:var(--primary);color:#fff;border:none;cursor:pointer;padding:10px 12px;font-weight:600}.muted{color:var(--muted);font-size:13px}
    .top-row{display:flex;justify-content:space-between;align-items:center;gap:10px}.greeting{font-size:16px;font-weight:700;color:#213547}.accountNo{font-size:13px;color:#495057;margin-top:2px}
    #transactionList{max-height:400px;overflow-y:auto;border:1px solid #eef2ff;padding:6px;border-radius:8px;background:#fff}
    #transactionList.expanded{max-height:900px}.tx{padding:10px;border-bottom:1px solid #f1f4ff;font-size:14px;color:#1f2937;display:flex;justify-content:space-between;align-items:center;gap:8px}
    .tx .tx-left{display:flex;flex-direction:column}.tx .tx-amt{font-weight:700}.tx .tx-type{font-size:13px;color:#6b7280;margin-top:4px}.tx:last-child{border-bottom:none}
    .tx.sent .tx-amt{color:#ef4444}.tx.received .tx-amt{color:#0b6b3a}
    .balance-wrap{display:flex;flex-direction:column;align-items:flex-start;gap:8px;margin-top:12px}.balance{font-size:28px;color:var(--success);font-weight:800}#btnAddMoney{width:160px;padding:8px 12px;border-radius:10px}
    .services-row{display:flex;gap:12px;margin-top:14px}.service{flex:1;background:#fbfbff;border-radius:12px;padding:12px;text-align:center;cursor:pointer;box-shadow:inset 0 -6px 0 rgba(91,77,255,.03)}.service i{font-size:20px;margin-bottom:8px;color:var(--accent);display:block}.service small{display:block;font-size:12px;color:#233142;font-weight:600}
    .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-top:12px}.grid-item{background:#fbfbff;border-radius:10px;padding:10px;text-align:center;cursor:pointer;font-size:13px}.grid-item i{font-size:16px;color:var(--accent);margin-bottom:6px;display:block}
    .tx-control{background:transparent;border:none;cursor:pointer;font-size:16px;color:var(--accent);padding:6px;border-radius:8px}.tx-control:focus{outline:none;box-shadow:0 2px 8px rgba(91,77,255,.12)}
    .bottom-nav{position:fixed;bottom:10px;left:50%;transform:translateX(-50%);background:#fff;width:520px;max-width:96%;border-radius:16px;display:flex;justify-content:space-around;padding:10px;box-shadow:0 10px 30px rgba(0,0,0,.08);z-index:150}.bottom-nav .nav-btn{text-align:center;flex:1;cursor:pointer;padding:6px 8px}.bottom-nav i{font-size:18px;color:var(--accent)}.bottom-nav small{display:block;font-size:11px;color:#334155;margin-top:4px}
    @media (max-width:560px){.wrap{padding:12px}.bottom-nav{width:calc(100% - 24px);left:12px;transform:none;border-radius:12px}}
  </style>
</head>
<body>

  <header>
    <div class="logo">PAYGO</div>
    <i id="hamburgerBtn" class="fas fa-bars hamburger" title="Menu"></i>
    <div id="profileMenu">
      <div id="menuProfile">Profile</div>
      <div id="menuKYC">KYC</div>
      <div id="menuTier">Tier</div>
      <div id="menuSettings">Settings</div>
      <div id="menuLogout">Logout</div>
    </div>
  </header>

  <div class="wrap">

    <!-- REGISTER -->
    <div id="registerCard" class="card">
      <h2>Create account</h2>
      <input id="Username" placeholder="Username (required)" />
      <input id="full_name" placeholder="Full name (optional)" />
      <input id="regNumber" placeholder="Phone number (11 digits)" maxlength="15" type="tel"/>
      <input id="regEmail" placeholder="Email (optional)" type="email" />
      <input id="regPassword" type="password" placeholder="Password" />
      <button id="btnRegister">Register</button>
      <p class="muted">Already have account? <a href="#" id="toLoginLink">Login</a></p>
    </div>

    <!-- LOGIN -->
    <div id="loginCard" class="card hidden">
      <h2>Login</h2>
      <input id="loginUsername" placeholder="Username" />
      <input id="loginPassword" type="password" placeholder="Password" />
      <button id="btnLogin">Login</button>
      <p class="muted">Don't have account? <a href="#" id="toRegisterLink">Register</a></p>
    </div>

    <!-- DASHBOARD -->
    <div id="dashboardCard" class="card hidden">
      <div class="top-row">
        <div>
          <div class="greeting" id="greeting">Hello ðŸ‘‹</div>
          <div class="accountNo" id="acctNumberDisplay"></div>
        </div>
      </div>

      <div class="balance-wrap">
        <h3 style="margin:8px 0 0 0">Available Balance</h3>
        <div class="balance" id="balanceDisplay">â‚¦0.00</div>
        <button id="btnAddMoney">Add Money</button>
      </div>
      <div class="tx-header" style="margin-top:12px;">
        <h3 style="margin:0">Recent Transactions</h3>
        <button id="txExpandBtn" class="tx-control" title="Expand / Collapse transactions"><i class="fas fa-chevron-down"></i></button>
      </div>
      <div id="transactionList" class="card" style="padding:8px; margin-top:8px;"></div>

      <!-- Row of 3 primary services -->
      <div class="services-row" style="margin-top:16px;">
        <div class="service" id="toBankBtn"><i class="fas fa-university"></i><small>To Bank</small></div>
        <div class="service" id="toWalletBtn"><i class="fas fa-wallet"></i><small>Wallet</small></div>
        <div class="service" id="savingsBtn"><i class="fas fa-piggy-bank"></i><small>Savings</small></div>
      </div>

      <!-- Other services grid -->
      <div class="grid" style="margin-top:14px;">
        <div class="grid-item"><i class="fas fa-phone"></i><small>Airtime</small></div>
        <div class="grid-item"><i class="fas fa-wifi"></i><small>Data</small></div>
        <div class="grid-item"><i class="fas fa-tv"></i><small>TV</small></div>
        <div class="grid-item"><i class="fas fa-bolt"></i><small>Electricity</small></div>
        <div class="grid-item"><i class="fas fa-futbol"></i><small>Betting</small></div>
        <div class="grid-item"><i class="fas fa-gift"></i><small>Gift Card</small></div>
        <div class="grid-item"><i class="fas fa-store"></i><small>Business</small></div>
        <div class="grid-item"><i class="fas fa-cog"></i><small>More</small></div>
      </div>
    </div>

    <!-- TO BANK PAGE -->
    <div id="toBankPage" class="card hidden">
      <h2>Send to Bank</h2>
      <input id="recipientAccount" placeholder="Recipient username or account number (last 10 digits)" />
      <div class="muted" id="recipientPreview">Enter recipient username or account number</div>
      <input id="sendAmount" type="number" placeholder="Amount" />
      <button id="btnSend">Send</button>
      <button id="btnCancelSend" style="background:#aaa;margin-top:8px;">Back</button>
    </div>
  </div>

  <!-- Bottom Navigation -->
  <div class="bottom-nav" role="navigation" aria-label="Bottom navigation">
    <div class="nav-btn" id="navHome"><i class="fas fa-home"></i><small>Home</small></div>
    <div class="nav-btn" id="navLoan"><i class="fas fa-hand-holding-usd"></i><small>Loan</small></div>
    <div class="nav-btn" id="navRefer"><i class="fas fa-users"></i><small>Refer</small></div>
  </div>

<script>
const API_BASE = "https://payme-update.onrender.com"; // change to your backend URL if needed
document.addEventListener("DOMContentLoaded", () => {
  // token helpers
  function saveToken(t){ localStorage.setItem("token", t); }
  function getToken(){ return localStorage.getItem("token"); }
  function clearToken(){ localStorage.removeItem("token"); }

  // element lookups (IDs must match your HTML exactly)
  const registerCard = document.getElementById("registerCard");
  const loginCard = document.getElementById("loginCard");
  const dashboardCard = document.getElementById("dashboardCard");
  const toBankPage = document.getElementById("toBankPage");

  const regUsername = document.getElementById("Username");
  const regName = document.getElementById("full_name");
  const regNumber = document.getElementById("regNumber");
  const regEmail = document.getElementById("regEmail");
  const regPassword = document.getElementById("regPassword");
  const btnRegister = document.getElementById("btnRegister");

  const loginUsername = document.getElementById("loginUsername");
  const loginPassword = document.getElementById("loginPassword");
  const btnLogin = document.getElementById("btnLogin");

  const greeting = document.getElementById("greeting");
  const acctNumberDisplay = document.getElementById("acctNumberDisplay");
  const balanceDisplay = document.getElementById("balanceDisplay");
  const transactionList = document.getElementById("transactionList");

  const toBankBtn = document.getElementById("toBankBtn");
  const toWalletBtn = document.getElementById("toWalletBtn");
  const savingsBtn = document.getElementById("savingsBtn");

  const btnCancelSend = document.getElementById("btnCancelSend");
  const recipientAccount = document.getElementById("recipientAccount");
  const recipientPreview = document.getElementById("recipientPreview");
  const sendAmount = document.getElementById("sendAmount");
  const btnSend = document.getElementById("btnSend");

  const toLoginLink = document.getElementById("toLoginLink");
  const toRegisterLink = document.getElementById("toRegisterLink");

  const profileMenu = document.getElementById("profileMenu");
  const hamburgerBtn = document.getElementById("hamburgerBtn");
  const menuLogout = document.getElementById("menuLogout");

  const txExpandBtn = document.getElementById("txExpandBtn");
  const btnAddMoney = document.getElementById("btnAddMoney");

  let currentUser = null;

  function showCard(card){
    [registerCard, loginCard, dashboardCard, toBankPage].forEach(c => c.classList.add("hidden"));
    card.classList.remove("hidden");
  }
  function showToast(msg){ alert(msg); }

  // register (sends username, password, full_name, phone, email)
  btnRegister.addEventListener("click", async () => {
    const username = (regUsername.value||"").trim();
    const password = (regPassword.value||"").trim();
    const full_name = (regName.value||"").trim() || username;
    const phone = (regNumber.value||"").trim();
    const email = (regEmail.value||"").trim();
    if(!username || !password){ showToast("Username and password required"); return; }

    try {
      const res = await fetch(`${API_BASE}/register`, {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body: JSON.stringify({ username, password, full_name, phone, email })
      });
      const data = await res.json();
      if(res.ok && data.success){ showToast("Registered â€” please login"); showCard(loginCard); }
      else showToast(data.message || "Registration failed");
    } catch(e){ console.error(e); showToast("Error connecting to server"); }
  });

  // login (sends username, password)
  btnLogin.addEventListener("click", async () => {
    const username = (loginUsername.value||"").trim();
    const password = (loginPassword.value||"").trim();
    if(!username || !password){ showToast("Username and password required"); return; }

    try {
      const res = await fetch(`${API_BASE}/login`, {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body: JSON.stringify({ username, password })
      });
      const data = await res.json();
      if(res.ok && data.success){
        if(data.token) saveToken(data.token);
        currentUser = username;
        await loadProfile();
      } else showToast(data.message || "Login failed");
    } catch(e){ console.error(e); showToast("Error connecting to server"); }
  });

  async function loadProfile(){
    const token = getToken();
    if(!token){ showCard(loginCard); return; }
    try {
      const res = await fetch(`${API_BASE}/user/profile`, { headers: { Authorization: `Bearer ${token}` } });
      const data = await res.json();
      if(res.ok && data.success){
        currentUser = data.username;
        greeting.textContent = `Hello ðŸ‘‹ ${data.full_name || data.username}`;
        const acctText = data.account_number ? `Account: ${data.account_number}` : (data.phone ? `Phone: ${data.phone}` : `Username: ${data.username}`);
        acctNumberDisplay.textContent = acctText;
        balanceDisplay.textContent = `â‚¦${(typeof data.balance === 'number' ? data.balance : Number(data.balance||0)).toFixed(2)}`;
        showCard(dashboardCard);
        await loadTransactions();
      } else {
        clearToken();
        showCard(loginCard);
        showToast(data.message || "Session expired, login again");
      }
    } catch(e){ console.error(e); showToast("Error loading profile"); }
  }

  async function loadTransactions(){
    const token = getToken();
    if(!token){ transactionList.innerHTML = "<p class='muted'>Login to see transactions</p>"; return; }
    try {
      const res = await fetch(`${API_BASE}/transactions`, { headers:{ Authorization: `Bearer ${token}` } });
      const data = await res.json();
      transactionList.innerHTML = "";
      const txs = (res.ok && data && data.success && Array.isArray(data.transactions)) ? data.transactions : [];
      if(txs.length === 0){ transactionList.innerHTML = "<p class='muted'>No transactions yet.</p>"; return; }
      txs.forEach(tx => {
        const isSent = tx.sender === currentUser;
        // prefer friendly names if present
        const receiverLabel = tx.receiver_name || tx.receiver;
        const senderLabel = tx.sender_name || tx.sender;
        const typeText = isSent ? `Sent to ${receiverLabel}` : `Received from ${senderLabel}`;
        const dateText = tx.timestamp ? new Date(tx.timestamp).toLocaleString() : "";
        const amt = Number(tx.amount || 0);
        const div = document.createElement("div");
        div.className = `tx ${isSent ? "sent" : "received"}`;
        div.innerHTML = `
          <div class="tx-left">
            <div class="tx-type">${typeText}</div>
            <div class="tx-type" style="font-size:12px;color:#94a3b8;margin-top:6px;">${dateText}</div>
          </div>
          <div class="tx-amt">${isSent ? "-" : "+"}â‚¦${amt.toFixed(2)}</div>
        `;
        transactionList.appendChild(div);
      });
    } catch(e){ console.error(e); transactionList.innerHTML = "<p class='muted'>Error loading transactions</p>"; }
  }

  // transfer: receiver can be username or account number (last 10 digits)
  btnSend.addEventListener("click", async () => {
    const receiver = (recipientAccount.value||"").trim();
    const amount = parseFloat(sendAmount.value);
    if(!receiver){ showToast("Recipient username required"); return; }
    if(isNaN(amount) || amount <= 0){ showToast("Enter a valid amount"); return; }

    try {
      const res = await fetch(`${API_BASE}/transfer`, {
        method:"POST",
        headers:{"Content-Type":"application/json", Authorization: `Bearer ${getToken()}`},
        body: JSON.stringify({ receiver, amount })
      });
      const data = await res.json();
      if(res.ok && data.success){
        showToast("Transfer successful");
        if(data.sender && typeof data.sender.balance !== "undefined"){
          balanceDisplay.textContent = `â‚¦${Number(data.sender.balance).toFixed(2)}`;
        } else {
          await loadProfile();
        }
        await loadTransactions();
        recipientAccount.value = "";
        sendAmount.value = "";
        showCard(dashboardCard);
      } else {
        showToast(data.message || "Transfer failed");
      }
    } catch(e){ console.error(e); showToast("Error sending money"); }
  });

  // UI & misc wiring
  toBankBtn.addEventListener("click", () => showCard(toBankPage));
  btnCancelSend.addEventListener("click", () => showCard(dashboardCard));
  toLoginLink.addEventListener("click", (e)=>{ e.preventDefault(); showCard(loginCard); });
  toRegisterLink.addEventListener("click", (e)=>{ e.preventDefault(); showCard(registerCard); });

  hamburgerBtn.addEventListener("click", ()=> {
    profileMenu.style.display = profileMenu.style.display === "block" ? "none" : "block";
  });
  document.addEventListener("click", (e) => {
    if(!profileMenu.contains(e.target) && e.target !== hamburgerBtn) profileMenu.style.display = "none";
  });
  menuLogout.addEventListener("click", () => {
    clearToken(); currentUser = null; showCard(loginCard);
  });

  txExpandBtn.addEventListener("click", () => {
    transactionList.classList.toggle("expanded");
    const icon = txExpandBtn.querySelector("i");
    if(transactionList.classList.contains("expanded")) icon.className = "fas fa-chevron-up";
    else icon.className = "fas fa-chevron-down";
  });

  recipientAccount.addEventListener("input", () => {
    const v = (recipientAccount.value||"").trim();
    recipientPreview.textContent = v ? `Sending to: ${v}` : "Enter recipient username";
  });

  btnAddMoney.addEventListener("click", async () => {
    const amtStr = prompt("Enter amount to add (this is UI-only demo):");
    const amt = parseFloat(amtStr);
    if(!isNaN(amt) && amt > 0){
      showToast(`Demo: +â‚¦${amt.toFixed(2)} added locally (not persisted).`);
      const curText = balanceDisplay.textContent.replace(/[^0-9.-]+/g,"");
      const curVal = parseFloat(curText) || 0;
      balanceDisplay.textContent = `â‚¦${(curVal + amt).toFixed(2)}`;
    } else showToast("Invalid amount");
  });

  toWalletBtn.addEventListener("click", () => showToast("Wallet transfer placeholder"));
  savingsBtn.addEventListener("click", () => showToast("Savings placeholder"));

  // auto-login if token present
  if(getToken()) loadProfile(); else showCard(loginCard);
});
</script>
</body>
</html>