<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PayMe App</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
body { font-family: Arial, sans-serif; margin: 0; background-color: #f7f7f7; }
.hidden { display: none; }
/* --- Forms --- */
form { max-width: 400px; margin: 50px auto; padding: 20px; background:white; border-radius:10px; box-shadow:0 5px 15px rgba(0,0,0,0.1);}
form h2 { text-align:center; margin-bottom:20px;}
form input { width:100%; padding:10px; margin:10px 0; border-radius:6px; border:1px solid #ccc;}
form button { width:100%; padding:10px; background:#5b4dff; color:white; border:none; border-radius:6px; cursor:pointer; font-size:16px;}
form small { display:block; text-align:center; margin-top:10px; color:gray; cursor:pointer; }
/* --- Dashboard --- */
.navbar { display:flex; justify-content:space-between; align-items:center; background:#222; padding:10px 20px;}
.navbar .logo { color:#fff; font-size:20px; font-weight:bold;}
.balance-card, .history-card, .quick-actions, .services, .fish{ margin:30px; padding:20px; border-radius:12px; background:white; }
.balance-card h1 { margin:10px 0; }
.quick-actions, .services,.fish { display:flex; justify-content:space-around; flex-wrap:wrap; gap:10px; }
.quick-actions div, .services div, .fish div { text-align:center; font-size:14px; cursor:pointer; }
.quick-actions div i, .services div i ,.fish div i{ font-size:24px; color:purple; }
#transactionList { list-style:none; padding:0; margin:0; max-height:250px; overflow-y:auto;}
#transactionList li { border-bottom:1px solid #eee; padding:10px 0; font-size:14px;}
#transactionList li.deposit { background:#e0ffe0; }
#transactionList li.withdraw { background:#ffe0e0; }
#transactionList li span.amount { font-weight:bold; }
#transactionList li span.type { font-style:italic; color:gray; }
/* Profile Modal */
#profileModal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; }
#profileModal .modal-content { background:white; padding:20px; border-radius:10px; width:90%; max-width:400px; }
</style>
</head>
<body>

<!-- Register -->
<section id="registerSection">
<form id="registerForm">
<h2>Register</h2>
<input type="text" placeholder="Username" id="regUsername" required>
<input type="text" placeholder="Phone (11 digits)" id="regPhone" required>
<input type="password" placeholder="Password" id="regPassword" required>
<button type="submit">Register</button>
<small id="toLogin">Already have account? Login</small>
</form>
</section>

<!-- Login -->
<section id="loginSection" class="hidden">
<form id="loginForm">
<h2>Login</h2>
<input type="text" placeholder="Phone (11 digits)" id="loginPhone" required>
<input type="password" placeholder="Password" id="loginPassword" required>
<button type="submit">Login</button>
<small id="toRegister">Don't have account? Register</small>
</form>
</section>

<!-- Dashboard -->
<section id="dashboardSection" class="hidden">
<nav class="navbar">
<div class="logo">PAYME</div>
<div>
<button id="profileBtn">Profile</button>
<button id="logoutBtn">Logout</button>
</div>
</nav>

<div class="balance-card">
<h3>Available Balance</h3>
<h1 id="balanceDisplay">₦0.00</h1>
<button id="addMoneyBtn">Add Money</button>
</div>

<div class="history-card">
<h3>Transaction History</h3>
<ul id="transactionList"><li>No transactions yet</li></ul>
</div>

<div class="quick-actions">
<div id="toBankBtn"><i class="fas fa-university"></i><br>To Bank</div>
<div id="toWalletBtn"><i class="fas fa-wallet"></i><br>To Wallet</div>
<div id="atmBtn"><i class="fas fa-credit-card"></i><br>ATM Card</div>
</div>

<div class="services">
<div id="airtimeBtn"><i class="fas fa-phone"></i><br>Airtime</div>
<div id="dataBtn"><i class="fas fa-wifi"></i><br>Data</div>
<div id="electricBtn"><i class="fas fa-bolt"></i><br>Electricity</div>
<div id="bettingBtn"><i class="fas fa-futbol"></i><br>Betting</div>
<div id="tvBtn"><i class="fas fa-tv"></i><br>TV</div>
    <section>
     <div id="loanBtn"><i class="fas fa-hand-holding-usd"></i><br>Loan</div>
<div id="businessBtn"><i class="fas fa-briefcase"></i><br>Business</div>
<div id="earnBtn"><i class="fas fa-users"></i><br>Refer & Earn</div>
</div>
</section>
</section>
    

   
<!-- To Bank Section -->
<section id="toBankSection" class="hidden">
<form id="toBankForm" style="max-width:400px; margin:50px auto; padding:20px; background:white; border-radius:10px;">
<h2>Send Money</h2>
<input type="text" placeholder="Receiver Phone (11 digits)" id="receiverPhone" required>
<p id="receiverName" style="margin:5px 0;color:green;"></p>
<input type="number" placeholder="Amount" id="sendAmount" required>
<button type="submit">Send</button>
<small id="backDashboard" style="display:block; text-align:center; margin-top:10px; cursor:pointer;">Back to Dashboard</small>
</form>
</section>

<!-- Profile Modal -->
<div id="profileModal">
<div class="modal-content">
<h2>My Profile</h2>
<p><b>Username:</b> <span id="profileUsername"></span></p>
<p><b>Phone:</b> <span id="profilePhone"></span></p>
<p><b>Account No:</b> <span id="profileAccount"></span></p>
<p><b>Balance:</b> ₦<span id="profileBalance"></span></p>
<button id="closeProfile">Close</button>
</div>
</div>

<script>
let currentUser = null;

function showSection(sec){
    document.querySelectorAll('section').forEach(s=>s.classList.add('hidden'));
    document.getElementById(sec).classList.remove('hidden');
}

// --- Register ---
document.getElementById('registerForm').addEventListener('submit', async(e)=>{
    e.preventDefault();
    const username = document.getElementById('regUsername').value;
    const phone = document.getElementById('regPhone').value;
    const password = document.getElementById('regPassword').value;
    const res = await fetch('https://payme-update.onrender.com/register',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({username, phone, password})
    });
    const data = await res.json();
    alert(data.message);
    if(res.ok) showSection('loginSection');
});

// Switch forms
document.getElementById('toLogin').addEventListener('click', ()=> showSection('loginSection'));
document.getElementById('toRegister').addEventListener('click', ()=> showSection('registerSection'));

// --- Login ---
document.getElementById('loginForm').addEventListener('submit', async(e)=>{
    e.preventDefault();
    const phone = document.getElementById('loginPhone').value;
    const password = document.getElementById('loginPassword').value;
    const res = await fetch('https://payme-update.onrender.com/login',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({phone,password})
    });
    const data = await res.json();
    if(!res.ok){ alert(data.message); return;}
    currentUser = data.user;
    showSection('dashboardSection');
    loadDashboard();
    loadTransactions();
});

// --- Dashboard ---
function loadDashboard(){
    if(!currentUser) return;
    document.getElementById('balanceDisplay').innerText = `₦${currentUser.balance}`;
}

// --- Profile ---
document.getElementById('profileBtn').addEventListener('click',()=>{
    if(!currentUser) return;
    document.getElementById('profileUsername').innerText = currentUser.username;
    document.getElementById('profilePhone').innerText = currentUser.phone;
    document.getElementById('profileAccount').innerText = currentUser.account_number;
    
document.getElementById('profileBalance').innerText = currentUser.balance;
    document.getElementById('profileModal').style.display='flex';
});
document.getElementById('closeProfile').addEventListener('click', ()=> {
    document.getElementById('profileModal').style.display='none';
});

// --- Logout ---
document.getElementById('logoutBtn').addEventListener('click', ()=>{
    currentUser = null;
    showSection('loginSection');
});

// --- Add Money ---
document.getElementById('addMoneyBtn').addEventListener('click', async()=>{
    const amount = parseFloat(prompt('Enter amount to add:'));
    if(isNaN(amount) || amount<=0) return alert('Invalid amount!');
    const res = await fetch('https://payme-update.onrender.com/update-balance',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({userId:currentUser.id, amount})
    });
    const data = await res.json();
    alert(data.message);
    if(res.ok){
        currentUser.balance = data.balance;
        loadDashboard();
        loadTransactions();
    }
});

// --- ToBank ---
document.getElementById('toBankBtn').addEventListener('click',()=>showSection('toBankSection'));
document.getElementById('backDashboard').addEventListener('click',()=>showSection('dashboardSection'));

// Receiver Name display
document.getElementById('receiverPhone').addEventListener('input', async()=>{
    const phone = document.getElementById('receiverPhone').value;
    if(phone.length<10){ document.getElementById('receiverName').innerText=''; return; }
    const acct = phone.slice(-10);
    const res = await fetch('https://payme-update.onrender.com/user-by-account',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({accountNumber:acct})
    });
    const data = await res.json();
    if(data.username) document.getElementById('receiverName').innerText = `Receiver: ${data.username}`;
    else document.getElementById('receiverName').innerText = '';
});

// Send Money
document.getElementById('toBankForm').addEventListener('submit', async(e)=>{
    e.preventDefault();
    const phone = document.getElementById('receiverPhone').value;
    const receiverAccount = phone.slice(-10);
    const amount = parseFloat(document.getElementById('sendAmount').value);
    if(isNaN(amount) || amount<=0){ alert('Enter valid amount'); return;}

    // Get receiver ID first
    const resUser = await fetch('https://payme-update.onrender.com/user-by-account',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({accountNumber:receiverAccount})
    });
    const dataUser = await resUser.json();
    if(!dataUser.userId) return alert('Receiver not found!');

    const res = await fetch('https://payme-update.onrender.com/send',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({userId: currentUser.id, receiverId: dataUser.userId, amount})
    });
    const data = await res.json();
    alert(data.message);
    if(res.ok){ 
        currentUser.balance = data.balance; 
        loadDashboard(); 
        loadTransactions(); 
        showSection('dashboardSection'); 
    }
});

// --- Load Transaction History ---
async function loadTransactions(){
    if(!currentUser) return;
    const res = await fetch('https://payme-update.onrender.com/transactions',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({userId:currentUser.id})
    });
    const data = await res.json();
    const list = document.getElementById('transactionList');
    list.innerHTML='';
    if(!data || data.length===0){
        list.innerHTML='<li>No transactions yet</li>';
        return;
    }
    data.forEach(tx=>{
        const li = document.createElement('li');
        li.className = tx.type.startsWith('Deposit') || tx.type.startsWith('Received') ? 'deposit':'withdraw';
        li.innerHTML = `<span class="type">${tx.type}</span>: <span class="amount">₦${tx.amount}</span> <small>${tx.date}</small>`;
        list.appendChild(li);
    });
}
</script>
</body>
</html>
    