<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Transaction History</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
  <style>
    :root{
      --primary:#00c853;
      --primary-dark:#009624;
      --bg:#ffffff;
      --card:#ffffff;
      --line:#e0e0e0;
      --text:#1b1b1b;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      height:100vh;display:flex;flex-direction:column;
    }
    header{
      display:flex;align-items:center;gap:10px;
      padding:14px;border-bottom:1px solid var(--line);
      background:#fff;position:sticky;top:0;
    }
    header h2{flex:1;text-align:center;font-size:16px;font-weight:700}
    .tx-list{flex:1;overflow-y:auto;padding:12px}
    .tx{display:flex;justify-content:space-between;padding:12px;border-bottom:1px solid #eee}
    .tx .info{font-size:13px}
    .tx .amount{font-weight:700}
    .Deposit,.Transfer\ In{color:green}
    .Transfer\ Out{color:red}
    .empty{text-align:center;color:#777;margin-top:30px;font-size:14px}
  </style>
</head>
<body>
  <header>
    <a href="javascript:void(0);" onclick="goBack()"><i class="fa-solid fa-arrow-left"></i></a>
    <h2>Transaction History</h2>
    <span style="width:20px"></span>
  </header>

  <div class="tx-list" id="txList"></div>

  <script>
    const API_BASE = "https://payme-update.onrender.com";

    async function renderTransactions() {
      const user = JSON.parse(localStorage.getItem("loggedInUser"));
      if (!user) {
        alert("⚠️ Please login first.");
        window.location.href = "paymelogin.html";
        return;
      }

      const container = document.getElementById("txList");
      container.innerHTML = "<p class='empty'>Loading...</p>";

      try {
        const res = await fetch(`${API_BASE}/transactions/${user.phone}`);
        const data = await res.json();

        if (res.ok && data.length > 0) {
          container.innerHTML = "";
          data.forEach(tx => {
            const div = document.createElement("div");
            div.className = "tx";
            const sign = (tx.type === "Deposit" || tx.type === "Transfer In") ? "+" : "-";
            const formattedDate = new Date(tx.date).toLocaleString();

            div.innerHTML = `
              <div class="info">
                <div>${tx.type} (${tx.other_party})</div>
                <div style="font-size:12px;color:#777">${formattedDate}</div>
              </div>
              <div class="amount ${tx.type.replace(" ", "\\ ")}">
                ${sign}₦${tx.amount}
              </div>
            `;
            container.appendChild(div);
          });
        } else {
          container.innerHTML = "<p class='empty'>No transactions yet</p>";
        }
      } catch (err) {
        console.error(err);
        container.innerHTML = "<p class='empty'>⚠️ Failed to load transactions.</p>";
      }
    }

    renderTransactions();

function goBack() {
  if (document.referrer && document.referrer !== "") {
    window.history.back(); // go to previous page in history
  } else {
    window.location.replace("profile.html"); // fallback if no history
  }
}
  </script>
</body>
</html>